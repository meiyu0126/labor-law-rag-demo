# ğŸ“‚ ä¼æ¥­å‹åŸºæ³•æ™ºæ…§å•ç­”åŠ©æ‰‹ (Labor Law RAG Assistant)

é€™æ˜¯ä¸€å€‹çµåˆ **RAG (Retrieval-Augmented Generation)** æŠ€è¡“èˆ‡ **å³æ™‚ç¶²è·¯çˆ¬èŸ²** çš„ AI æ™ºæ…§å•ç­”ç³»çµ±ã€‚
ç³»çµ±é è¨­æœƒè‡ªå‹•çˆ¬å– [å…¨åœ‹æ³•è¦è³‡æ–™åº«](https://law.moj.gov.tw/) çš„æœ€æ–°å‹å‹•åŸºæº–æ³•æ¢æ–‡ï¼Œç¢ºä¿å›ç­”ä¾æ“šæ˜¯æœ€æ–°çš„æ³•å¾‹è¦ç¯„ï¼›åŒæ™‚ä¹Ÿæ”¯æ´ä½¿ç”¨è€…ä¸Šå‚³è‡ªå®šç¾©çš„ PDF å…§éƒ¨æ–‡ä»¶ï¼ˆå¦‚å“¡å·¥æ‰‹å†Šï¼‰ï¼Œå¯¦ç¾éˆæ´»çš„ä¼æ¥­ç´šæ–‡ä»¶å•ç­”ã€‚

ğŸ‘‰ **[é»æ“Šé€™è£¡é«”é©— Live Demo](https://labor-law-rag-demo-drnxcasmvkg3mursnab7ti.streamlit.app/)**

---

### ğŸš€ å°ˆæ¡ˆç‰¹è‰² (Project Highlights)

#### 1. é›™æ¨¡çµ„æ··åˆè³‡æ–™æº (Hybrid Data Sources)

ç³»çµ±èƒ½è™•ç†çµæ§‹åŒ–èˆ‡éçµæ§‹åŒ–è³‡æ–™ï¼š

* **ğŸ•·ï¸ è‡ªå‹•åŒ–æ³•è¦çˆ¬èŸ² (Automated Web Crawler)**ï¼š
* åˆ©ç”¨ `Requests` èˆ‡ `BeautifulSoup4` å¯¦ä½œ ETL æµç¨‹ï¼Œå¯å³æ™‚å¾å…¨åœ‹æ³•è¦è³‡æ–™åº«æŠ“å–æœ€æ–°å‹å‹•åŸºæº–æ³•ã€‚
* å¯å°‡ HTML è§£æç‚ºå¸¶æœ‰æ¢è™Ÿ (Metadata) çš„çµæ§‹åŒ– Document ç‰©ä»¶ï¼Œç¢ºä¿æª¢ç´¢æ™‚èƒ½ç²¾æº–å¼•ç”¨æ¢è™Ÿã€‚


* **ğŸ“„ è‡ªå®šç¾©æ–‡ä»¶ä¸Šå‚³ (User-Defined Knowledge Base)**ï¼š
* æ”¯æ´ä½¿ç”¨è€…ä¸Šå‚³ PDF å…§éƒ¨æ–‡ä»¶ï¼ˆå¦‚å…¬å¸ç« ç¨‹ï¼‰ã€‚
* é€é `tempfile` è™•ç†è¨˜æ†¶é«”èˆ‡å¯¦é«”æª”æ¡ˆè·¯å¾‘çš„è½‰æ›ï¼Œå¯¦ç¾å³æ™‚çš„çŸ¥è­˜åº«åˆ‡æ›ã€‚



#### 2. æ™ºæ…§å‹å¿«å–èˆ‡å‹•æ…‹æ›´æ–°æ©Ÿåˆ¶ (Smart Caching & CDC)

ç‚ºäº†å…¼é¡§ã€Œè³‡æ–™æ–°é®®åº¦ã€èˆ‡ã€Œç³»çµ±æ•ˆèƒ½ã€ï¼Œå¯¦ä½œäº†å¤šå±¤æ¬¡çš„å¿«å–ç­–ç•¥ï¼š

* **æ™‚é–“é©…å‹•å¿«å– (Time-Based Caching)**ï¼šçˆ¬èŸ²å‡½å¼è¨­å®š `@st.cache_data(ttl=3600)`ï¼Œç¢ºä¿ 1 å°æ™‚å…§ä¸æœƒé‡è¤‡è«‹æ±‚ï¼Œé¿å… IP è¢«å°é–ä¸¦é™ä½å»¶é²ã€‚
* **å…§å®¹é©…å‹•æ›´æ–° (Content-Based CDC)**ï¼š
* åˆ©ç”¨ `hashlib.md5` è¨ˆç®—çˆ¬å–å…§å®¹æˆ–ä¸Šå‚³æª”æ¡ˆçš„æ•¸ä½æŒ‡ç´‹ (Hash)ã€‚
* ç³»çµ±åƒ…åœ¨ **Hash å€¼æ”¹è®Š**ï¼ˆä»£è¡¨æ³•è¦ä¿®æ³•æˆ–æª”æ¡ˆå…§å®¹è®Šæ›´ï¼‰æ™‚ï¼Œæ‰æœƒè§¸ç™¼é«˜æˆæœ¬çš„å‘é‡è³‡æ–™åº«é‡å»ºï¼Œå¦å‰‡ç›´æ¥æ²¿ç”¨å¿«å–ï¼Œå¯¦ç¾ã€Œç§’å›ã€é«”é©—ä¸¦å¤§å¹…ç¯€çœ OpenAI API è²»ç”¨ã€‚



#### 3. é«˜ç²¾åº¦ RAG æª¢ç´¢æ¶æ§‹ (Precision RAG Architecture)

æ¡ç”¨æ¥­ç•Œæ¨™æº–çš„æŠ€è¡“å †ç–Šï¼Œè§£æ±º LLM å¹»è¦ºå•é¡Œï¼š

* **å…ˆé€²æ¨¡å‹æ‡‰ç”¨**ï¼šä½¿ç”¨ OpenAI æœ€æ–°çš„ `text-embedding-3-large` é€²è¡Œé«˜ç¶­åº¦èªæ„å‘é‡åŒ–ï¼Œæ­é…é«˜æ€§åƒ¹æ¯”çš„ `gpt-4o-mini` é€²è¡Œæ¨è«–ã€‚
* **MMR æ¼”ç®—æ³• (Maximal Marginal Relevance)**ï¼šæ¨æ£„å–®ç´”çš„ç›¸ä¼¼åº¦æœå°‹ï¼Œæ”¹ç”¨ MMR (`lambda_mult=0.80`)ï¼Œåœ¨ã€Œç›¸é—œæ€§ã€èˆ‡ã€Œå¤šæ¨£æ€§ã€é–“å–å¾—å¹³è¡¡ï¼Œé¿å…æª¢ç´¢çµæœéæ–¼å–®ä¸€ã€‚
* **LCEL éˆå¼æ¶æ§‹**ï¼šä½¿ç”¨ LangChain Expression Language (LCEL) å»ºæ§‹ `RunnableParallel`ï¼Œå¯¦ç¾æª¢ç´¢èˆ‡å°è©±æ­·å²è™•ç†çš„**è‡ªå‹•å¹³è¡ŒåŒ–**ï¼Œé™ä½ç³»çµ±å»¶é²ã€‚

#### 4. ä¸Šä¸‹æ–‡æ„ŸçŸ¥èˆ‡å¤šè¼ªå°è©± (Context-Aware & Multi-turn)

* **æ»‘å‹•è¦–çª—è¨˜æ†¶ (Sliding Window Memory)**ï¼šå¯¦ä½œå°è©±æ­·å²ç®¡ç†ï¼Œåƒ…ä¿ç•™æœ€å¾Œ 6 å‰‡è¨Šæ¯å‚³é€çµ¦ LLMã€‚é€™ä¸åƒ…èƒ½è®“ AI è¨˜ä½å‰æ–‡ï¼ˆå¦‚ï¼šã€Œé‚£åŠ ç­è²»å‘¢ï¼Ÿã€ï¼‰ï¼Œé‚„èƒ½æœ‰æ•ˆæ§åˆ¶ Token ç”¨é‡ï¼Œé˜²æ­¢ Context Window æº¢å‡ºã€‚

#### 5. å‹å–„çš„ä½¿ç”¨è€…ä»‹é¢èˆ‡é«”é©— (UI/UX)

* **ç²¾æº–ä¾†æºæº¯æº (Smart Citation)**ï¼šRAG çš„å›ç­”çš†æœƒé™„ä¸Šä¾†æºå‡ºè™•ã€‚ç³»çµ±èƒ½æ™ºæ…§åˆ¤æ–·ä¾†æºé¡å‹ï¼Œè‹¥æ˜¯æ³•è¦é¡¯ç¤ºã€Œæ¢è™Ÿã€ï¼Œè‹¥æ˜¯ PDF å‰‡é¡¯ç¤ºã€Œæª”å + é ç¢¼ã€ã€‚
* **è‡ªå‹•åŒ–æµç¨‹**ï¼šçµåˆ Streamlit çš„ Session State ç®¡ç†ï¼Œä½¿ç”¨è€…ç„¡éœ€æ‰‹å‹•é‡æ–°æ•´ç†ï¼Œç³»çµ±æœƒæ ¹æ“šä½¿ç”¨è€…æ“ä½œ(æ˜¯å¦ä¸Šå‚³æª”æ¡ˆ)è‡ªå‹•åˆ¤æ–·æ˜¯å¦éœ€è¦åˆ‡æ›çŸ¥è­˜åº«ã€‚

---

## ğŸ› ï¸ æŠ€è¡“å †ç–Š (Tech Stack)

| é¡åˆ¥ | æŠ€è¡“/å·¥å…· | èªªæ˜ |
| :--- | :--- | :--- |
| **Frontend** | **Streamlit** | å¿«é€Ÿå»ºæ§‹äº’å‹•å¼ Chat UIï¼Œæ•´åˆå´é‚Šæ¬„åƒæ•¸è¨­å®š |
| **Framework** | **LangChain** | ä½¿ç”¨ **LCEL** (LangChain Expression Language) å»ºæ§‹ Chain |
| **Model** | **OpenAI** | GPT-4o-mini (LLM), Text-Embedding-3-Large (Embedding) |
| **Database** | **ChromaDB** | æœ¬åœ°ç«¯è¼•é‡ç´šå‘é‡è³‡æ–™åº« (Vector Store) |
| **Crawler** | **BS4 & Requests** | HTML è§£æèˆ‡è³‡æ–™æ¸…æ´— |
| **Deployment** | **Streamlit Cloud** | CI/CD è‡ªå‹•åŒ–éƒ¨ç½² |

---

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

```text
labor-law-rag-demo/
â”œâ”€â”€ app.py                  # æ ¸å¿ƒä¸»ç¨‹å¼ (åŒ…å«çˆ¬èŸ²ã€ETLã€RAG Chainã€UI é‚è¼¯)
â”œâ”€â”€ requirements.txt        # å°ˆæ¡ˆä¾è³´å¥—ä»¶æ¸…å–®
â””â”€â”€ .env                    # ç’°å¢ƒè®Šæ•¸ (OpenAI API Key)
```  

---

## ğŸ’¡ æ ¸å¿ƒé‚è¼¯æµç¨‹ (System Workflow)

### 1. åˆå§‹åŒ– (Initialization)
* **ç³»çµ±å•Ÿå‹•æ™‚**ï¼šæª¢æŸ¥æ˜¯å¦æœ‰ä¸Šå‚³æª”æ¡ˆã€‚
* **ç„¡ä¸Šå‚³**ï¼šè§¸ç™¼çˆ¬èŸ² -> æŠ“å–å‹å‹•éƒ¨ç¶²é  -> è§£ææ¢æ–‡ -> å¯«å…¥ ChromaDBã€‚
* **æœ‰ä¸Šå‚³**ï¼šè®€å– PDF -> æ–‡å­—åˆ‡åˆ† (Chunking) -> å¯«å…¥ ChromaDBã€‚

### 2. æª¢ç´¢ (Retrieval)
* å°‡ä½¿ç”¨è€…å•é¡Œè½‰ç‚º Vectorã€‚
* ä½¿ç”¨ **MMR (Maximal Marginal Relevance)** æ¼”ç®—æ³•æœå°‹ Top-K ç›¸é—œç‰‡æ®µï¼Œå…¼é¡§ç›¸é—œæ€§èˆ‡å¤šæ¨£æ€§ã€‚

### 3. ç”Ÿæˆ (Generation)
* å°‡ã€Œæª¢ç´¢åˆ°çš„è³‡æ–™ã€èˆ‡ã€Œæ­·å²å°è©±ã€å¡«å…¥ Prompt Templateã€‚
* LLM ç”Ÿæˆå›ç­”ä¸¦æ¨™è¨»ä¾†æºã€‚

---

## ğŸ’» å¦‚ä½•åœ¨æœ¬åœ°ç«¯åŸ·è¡Œ (Local Installation)

å¦‚æœè¦åœ¨è‡ªå·±çš„é›»è…¦ä¸Šé‹è¡Œæ­¤å°ˆæ¡ˆï¼Œè«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿæ“ä½œï¼š

1.  **Clone å°ˆæ¡ˆ**
    ```bash
    git clone [https://github.com/meiyu0126/labor-law-rag-demo.git](https://github.com/meiyu0126/labor-law-rag-demo.git)
    cd labor-law-rag-demo
    ```

2.  **å»ºç«‹è™›æ“¬ç’°å¢ƒ (å»ºè­°)**
    ```bash
    # Windows
    python -m venv .venv
    .venv\Scripts\activate

    # Mac/Linux
    python3 -m venv .venv
    source .venv/bin/activate
    ```

3.  **å®‰è£ä¾è³´å¥—ä»¶**
    ```bash
    pip install -r requirements.txt
    ```

4.  **è¨­å®šç’°å¢ƒè®Šæ•¸**
    è«‹åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `.env` æª”æ¡ˆï¼Œä¸¦å¡«å…¥æ‚¨çš„ OpenAI API Keyï¼š
    ```text
    OPENAI_API_KEY="sk-proj-xxxxxxxx..."
    ```

5.  **å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼**
    ```bash
    streamlit run app.py
    ```
